#!/usr/bin/ksh

user=$1
database=$2
table=$3

displayTable()
{
	clear
	cnum=$(grep $table $user/$database/meta|cut -d":" -f2)
	for (( c = 0; c < cnum; c++ )); do
		part=$(($c+3))
		col=$(grep $table $user/$database/meta|cut -d":" -f $part)
		columns[c]=$col
	done
	echo ${columns[*]}|sed 's/ /'"\t"'/g'
	echo "___________________________________________________________________________"
	awk -F: '{print $0}' $user/$database/$table|tr ':' '\t'
	read
	clear
}


addColumn(){
	clear
	echo "Enter column name"
	read cname
	awk -F: -v co=$cname -v t=$table '{
		if($1==t){
			$2=$2+1
			print $0":"co 
		}
		else{
			print
		}
	}' $user/$database/meta|sed 's/ /:/g' > $user/$database/temp
	cat $user/$database/temp > $user/$database/meta
	rm $user/$database/temp

	sed -i s/$/:/g $user/$database/$table
	read
	clear
}

deleteColumn()
{
	clear
	echo "Enter column name"
	read cname

	colnum=$(awk -F: -v col=$cname -v t=$table '{
			if($1==t){
				for(i=3; i<NF+2; i++){
					if($i==col){
						print i-2
						break				
					}
				}
			}
		} ' $user/$database/meta)

	awk -F: -v col=$cname -v t=$table '{
		
		if($1==t){
			for(i=3; i<NF+2; i++){
				if($i==col){					
					break				
				}
			}
			$i=""
			$2=$2-1
			print $0
		}
		else{
			print $0
		}

	} ' $user/$database/meta|tr -s ' ' ':' > $user/$database/temp
	cat $user/$database/temp > $user/$database/meta

	awk -F: -v c=$colnum '{
		$c=""
		print $0
	}' $user/$database/$table|sed 's/[[:space:]]//'|tr -s ' ' ':' > $user/$database/temp
	cat $user/$database/temp > $user/$database/$table
	rm $user/$database/temp
	read
	clear
}

insertRow()
{
	clear
	cnum=$(grep $table $user/$database/meta|cut -d":" -f2)
	for (( c = 0; c < cnum; c++ )); do
		part=$(($c+3))
		echo "Enter value for $(grep $table $user/$database/meta|cut -d":" -f $part)"
		read val
		values[$c]=$val
	done
	echo ${values[*]}|sed 's/ /:/g'>>$user/$database/$table 
	read
	clear
}


updateRow()
{
	clear


	read
	clear
}


deleteRow()
{
	clear
	
	
	read
	clear
}


clear
select d_choice in "Display table's rows" "Add column" "Delete column" "Insert row" "Update row" "Delete row" "Back"
do
	case $d_choice in

		"Display table's rows" ) displayTable
				;;

		"Add column" ) addColumn
				;;

		"Delete column" ) deleteColumn
				;;

		"Insert row" ) insertRow
				;;

		"Update row" ) updateRow
				;;

		"Delete row" ) deleteRow
				;;

		"Back" ) break
				;;

		* ) printf $REPLY" is not an option\n"
				;;
	esac
done


